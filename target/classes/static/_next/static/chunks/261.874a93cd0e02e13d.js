"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[261],{5261:function(e,t,r){r.r(t),r.d(t,{LeafletMap:function(){return J},default:function(){return $}});var n=r(3779),o=r(1895);let s=(0,o.createContext)(null),i=s.Provider;var a=r(3632);function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let u=(0,o.forwardRef)(function({bounds:e,boundsOptions:t,center:r,children:n,className:s,id:u,placeholder:c,style:h,whenReady:f,zoom:p,...d},m){let[y]=(0,o.useState)({className:s,id:u,style:h}),[b,g]=(0,o.useState)(null);(0,o.useImperativeHandle)(m,()=>b?.map??null,[b]);let _=(0,o.useCallback)(n=>{if(null!==n&&null===b){let o=new a.Map(n,d);null!=r&&null!=p?o.setView(r,p):null!=e&&o.fitBounds(e,t),null!=f&&o.whenReady(f),g(Object.freeze({__version:1,map:o}))}},[]);(0,o.useEffect)(()=>()=>{b?.map.remove()},[b]);let w=b?o.createElement(i,{value:b},n):c??null;return o.createElement("div",l({},y,{ref:_}),w)});function c(e,t,r){return Object.freeze({instance:e,context:t,container:r})}function h(e,t){let r=e.pane??t.pane;return r?{...e,pane:r}:e}function f(e,t){var r;let n=null==t?function(t,r){let n=(0,o.useRef)();return n.current||(n.current=e(t,r)),n}:function(r,n){let s=(0,o.useRef)();s.current||(s.current=e(r,n));let i=(0,o.useRef)(r),{instance:a}=s.current;return(0,o.useEffect)(function(){i.current!==r&&(t(a,r,i.current),i.current=r)},[a,r,n]),s};return r=function(e){var t;let r=function(){let e=(0,o.useContext)(s);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}(),i=n(h(e,r),r);return function(e,t){let r=(0,o.useRef)(t);(0,o.useEffect)(function(){t!==r.current&&null!=e.attributionControl&&(null!=r.current&&e.attributionControl.removeAttribution(r.current),null!=t&&e.attributionControl.addAttribution(t)),r.current=t},[e,t])}(r.map,e.attribution),function(e,t){let r=(0,o.useRef)();(0,o.useEffect)(function(){return null!=t&&e.instance.on(t),r.current=t,function(){null!=r.current&&e.instance.off(r.current),r.current=null}},[e,t])}(i.current,e.eventHandlers),t=i.current,(0,o.useEffect)(function(){let e=r.layerContainer??r.map;return e.addLayer(t.instance),function(){r.layerContainer?.removeLayer(t.instance),r.map.removeLayer(t.instance)}},[r,t]),i},(0,o.forwardRef)(function(e,t){let{instance:n}=r(e).current;return(0,o.useImperativeHandle)(t,()=>n),null})}function p(e,t,r){let{opacity:n,zIndex:o}=t;null!=n&&n!==r.opacity&&e.setOpacity(n),null!=o&&o!==r.zIndex&&e.setZIndex(o)}r(1982);let d=f(function({url:e,...t},r){let n=new a.TileLayer(e,h(t,r));return c(n,r)},function(e,t,r){p(e,t,r);let{url:n}=t;null!=n&&n!==r.url&&e.setUrl(n)}),m=f(function({eventHandlers:e,params:t={},url:r,...n},o){let s=new a.TileLayer.WMS(r,{...t,...h(n,o)});return c(s,o)},function(e,t,r){p(e,t,r),null!=t.params&&t.params!==r.params&&e.setParams(t.params)}),y=a.TileLayer.WMS.extend({getFeatureParam:{feature_count:1,srs:"EPSG:4326",info_format:"application/json"},initialize(e,t){for(let e in this.getFeatureInfo)e in t&&(this.getFeatureInfo[e]=t[e]);"cql_filter"in t&&(this.getFeatureInfo.cql_filter=t.cql_filter),"propertyName"in t&&(this.getFeatureInfo.propertyName=t.propertyName),a.Util.setOptions(this,this.getFeatureParam),a.TileLayer.WMS.prototype.initialize.call(this,e,t)},onAdd(e){a.TileLayer.WMS.prototype.onAdd.call(this,e),e.on("click",this.getFeatureInfo,this)},onRemove(e){a.TileLayer.WMS.prototype.onRemove.call(this,e),e.off("click",this.getFeatureInfo,this)},getFeatureInfo(e){let t=this._map.latLngToContainerPoint(e.latlng),r=new a.Point(t.x,t.y,!0),n=this._map.getSize(),o={request:"GetFeatureInfo",query_layers:this.wmsParams.layers,height:n.y,width:n.x,bbox:this._map.getBounds().toBBoxString()},s={...this.wmsParams,...this.options,...o};s["1.3.0"===s.version?"i":"x"]=r.x,s["1.3.0"===s.version?"j":"y"]=r.y;let i=this._url+a.Util.getParamString(s,this._url,!1);this.fire("click",{url:i,params:s,latlng:e.latlng})}});a.TileLayer.InfoWMS=y,a.tileLayer.infoWMS=function(e,t){return new y(e,t)};var b=f(function(e,t){return{instance:new a.TileLayer.InfoWMS(e.url,e.params),context:t}},function(e,t,r){p(e,t,r)});let g=e=>{let{props:t}=e;return(0,n.jsx)("div",{className:"map-card",children:(0,n.jsxs)("div",{className:"map-card__container",children:[(null==t?void 0:t.region)&&(0,n.jsx)("span",{className:"card-title",children:null==t?void 0:t.region}),(null==t?void 0:t.District)&&(0,n.jsx)("span",{className:"card-title",children:null==t?void 0:t.District}),(null==t?void 0:t.okrug)&&(0,n.jsx)("span",{className:"card-title",children:null==t?void 0:t.okrug}),(null==t?void 0:t.name)&&(0,n.jsx)("span",{className:"card-title",children:null==t?void 0:t.name})]})})},_=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class w extends Error{constructor(e,t,r){let n=e.status||0===e.status?e.status:"",o=e.statusText||"",s=`${n} ${o}`.trim(),i=s?`status code ${s}`:"an unknown error";super(`Request failed with ${i}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=e,this.request=t,this.options=r}}class v extends Error{constructor(e){super("Request timed out"),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=e}}let T=e=>null!==e&&"object"==typeof e,x=(...e)=>{for(let t of e)if((!T(t)||Array.isArray(t))&&void 0!==t)throw TypeError("The `options` argument must be an object");return q({},...e)},R=(e={},t={})=>{let r=new globalThis.Headers(e),n=t instanceof globalThis.Headers,o=new globalThis.Headers(t);for(let[e,t]of o.entries())n&&"undefined"===t||void 0===t?r.delete(e):r.set(e,t);return r},q=(...e)=>{let t={},r={};for(let n of e)if(Array.isArray(n))Array.isArray(t)||(t=[]),t=[...t,...n];else if(T(n)){for(let[e,r]of Object.entries(n))T(r)&&e in t&&(r=q(t[e],r)),t={...t,[e]:r};T(n.headers)&&(r=R(r,n.headers),t.headers=r)}return t},S=(()=>{let e=!1,t=!1,r="function"==typeof globalThis.ReadableStream,n="function"==typeof globalThis.Request;return r&&n&&(t=new globalThis.Request("https://a.com",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type")),e&&!t})(),C="function"==typeof globalThis.AbortController,j="function"==typeof globalThis.ReadableStream,E="function"==typeof globalThis.FormData,P=["get","post","put","patch","head","delete"],L={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},O=Symbol("stop"),A=e=>P.includes(e)?e.toUpperCase():e,I=[413,429,503],k={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:I,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY},N=(e={})=>{if("number"==typeof e)return{...k,limit:e};if(e.methods&&!Array.isArray(e.methods))throw Error("retry.methods must be an array");if(e.statusCodes&&!Array.isArray(e.statusCodes))throw Error("retry.statusCodes must be an array");return{...k,...e,afterStatusCodes:I}};async function U(e,t,r){return new Promise((n,o)=>{let s=setTimeout(()=>{t&&t.abort(),o(new v(e))},r.timeout);r.fetch(e).then(n).catch(o).then(()=>{clearTimeout(s)})})}let D=!!globalThis.DOMException;function F(e){if(D)return new DOMException(e?.reason??"The operation was aborted.","AbortError");let t=Error(e?.reason??"The operation was aborted.");return t.name="AbortError",t}async function M(e,{signal:t}){return new Promise((r,n)=>{if(t){if(t.aborted){n(F(t));return}t.addEventListener("abort",o,{once:!0})}function o(){n(F(t)),clearTimeout(s)}let s=setTimeout(()=>{t?.removeEventListener("abort",o),r()},e)})}class H{static create(e,t){let r=new H(e,t),n=async()=>{if(r._options.timeout>2147483647)throw RangeError("The `timeout` option cannot be greater than 2147483647");await Promise.resolve();let e=await r._fetch();for(let t of r._options.hooks.afterResponse){let n=await t(r.request,r._options,r._decorateResponse(e.clone()));n instanceof globalThis.Response&&(e=n)}if(r._decorateResponse(e),!e.ok&&r._options.throwHttpErrors){let t=new w(e,r.request,r._options);for(let e of r._options.hooks.beforeError)t=await e(t);throw t}if(r._options.onDownloadProgress){if("function"!=typeof r._options.onDownloadProgress)throw TypeError("The `onDownloadProgress` option must be a function");if(!j)throw Error("Streams are not supported in your environment. `ReadableStream` is missing.");return r._stream(e.clone(),r._options.onDownloadProgress)}return e},o=r._options.retry.methods.includes(r.request.method.toLowerCase()),s=o?r._retry(n):n();for(let[e,n]of Object.entries(L))s[e]=async()=>{r.request.headers.set("accept",r.request.headers.get("accept")||n);let o=await s,i=o.clone();if("json"===e){if(204===i.status)return"";let e=await i.clone().arrayBuffer(),r=e.byteLength;if(0===r)return"";if(t.parseJson)return t.parseJson(await i.text())}return i[e]()};return s}constructor(e,t={}){if(Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=e,this._options={credentials:this._input.credentials||"same-origin",...t,headers:R(this._input.headers,t.headers),hooks:q({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},t.hooks),method:A(t.method??this._input.method),prefixUrl:String(t.prefixUrl||""),retry:N(t.retry),throwHttpErrors:!1!==t.throwHttpErrors,timeout:void 0===t.timeout?1e4:t.timeout,fetch:t.fetch??globalThis.fetch.bind(globalThis)},"string"!=typeof this._input&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&"string"==typeof this._input){if(this._input.startsWith("/"))throw Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(C){if(this.abortController=new globalThis.AbortController,this._options.signal){let e=this._options.signal;this._options.signal.addEventListener("abort",()=>{this.abortController.abort(e.reason)})}this._options.signal=this.abortController.signal}if(S&&(this._options.duplex="half"),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){let e="string"==typeof this._options.searchParams?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString(),t=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,"?"+e);(E&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(t,{...this.request}),this._options)}void 0!==this._options.json&&(this._options.body=JSON.stringify(this._options.json),this.request.headers.set("content-type",this._options.headers.get("content-type")??"application/json"),this.request=new globalThis.Request(this.request,{body:this._options.body}))}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount<this._options.retry.limit&&!(e instanceof v)){if(e instanceof w){if(!this._options.retry.statusCodes.includes(e.response.status))return 0;let t=e.response.headers.get("Retry-After");if(t&&this._options.retry.afterStatusCodes.includes(e.response.status)){let e=Number(t);return(Number.isNaN(e)?e=Date.parse(t)-Date.now():e*=1e3,void 0!==this._options.retry.maxRetryAfter&&e>this._options.retry.maxRetryAfter)?0:e}if(413===e.response.status)return 0}return Math.min(this._options.retry.backoffLimit,.3*2**(this._retryCount-1)*1e3)}return 0}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(r){let t=Math.min(this._calculateRetryDelay(r),2147483647);if(0!==t&&this._retryCount>0){for(let e of(await M(t,{signal:this._options.signal}),this._options.hooks.beforeRetry)){let t=await e({request:this.request,options:this._options,error:r,retryCount:this._retryCount});if(t===O)return}return this._retry(e)}throw r}}async _fetch(){for(let e of this._options.hooks.beforeRequest){let t=await e(this.request,this._options);if(t instanceof Request){this.request=t;break}if(t instanceof Response)return t}return!1===this._options.timeout?this._options.fetch(this.request.clone()):U(this.request.clone(),this.abortController,this._options)}_stream(e,t){let r=Number(e.headers.get("content-length"))||0,n=0;return 204===e.status?(t&&t({percent:1,totalBytes:r,transferredBytes:n},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(o){let s=e.body.getReader();async function i(){let{done:e,value:a}=await s.read();if(e){o.close();return}if(t){n+=a.byteLength;let e=0===r?0:n/r;t({percent:e,transferredBytes:n,totalBytes:r},a)}o.enqueue(a),await i()}t&&t({percent:0,transferredBytes:0,totalBytes:r},new Uint8Array),await i()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License © Sindre Sorhus */let W=e=>{let t=(t,r)=>H.create(t,x(e,r));for(let r of P)t[r]=(t,n)=>H.create(t,x(e,n,{method:r}));return t.create=e=>W(x(e)),t.extend=t=>W(x(e,t)),t.stop=O,t},z=W();var B=r(9450);let J=()=>{let[e,t]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t(!0)},[]);let[r,s]=(0,o.useState)(),[i,a]=(0,o.useState)();async function l(e){console.log("Ky event",e.url),await z.get(e.url).json().then(e=>a(e.features[0].properties))}let[c,h]=(0,o.useState)("auto_foot_graph_arh_obl"),f=(0,B.o)().layers,p=f.join(",");console.log("Layer string ",p),(0,o.useEffect)(()=>{s(_(4).toString())},[c,p]);let[y,w]=(0,o.useState)({center:{lat:66,lng:33},zoom:5}),[v,T]=(0,o.useState)();return(0,o.useCallback)(e=>{let{features:t,point:{x:r,y:n}}=e,o=t&&t[0];a(o&&{feature:o,x:r,y:n})},[]),console.log("Layer"+c),console.log("Card Data",i),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(u,{...y,minZoom:2,children:[i&&(0,n.jsx)(g,{props:i}),(0,n.jsx)(d,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,n.jsx)(b,{url:"http://62.113.107.81:8081/geoserver/department/wms",params:{Request:"GetFeatureInfo",key:r,layers:p,format:"image/png",transparent:!0,attribution:"myattribution"},eventHandlers:{click:e=>l(e)}},"".concat(r,"-info")),(0,n.jsx)(m,{crossOrigin:"",url:"http://62.113.107.81:8081/geoserver/department/wms",layers:p,format:"image/png",transparent:!0,version:"1.1.0",attribution:"myattribution"},r)]})})};var $=J}}]);